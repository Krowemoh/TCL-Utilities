*
   GIT.FILENAME = 'ADD-DICT'
   GIT.REPO = 'https://github.com/Krowemoh/TCL-Utilities.git'
*
* VERSION
*
   VERSION = '1'
*
   @USER1 = 'ADD-DICT'
   @USER2 = 'ADD-DICT'
*
   EQU TRUE TO 1
   EQU FALSE TO 0
*
   EQU DICT.TYPE TO 1
   EQU DICT.FIELD TO 2
   EQU DICT.DESCRIPTION TO 3
   EQU DICT.MV.RELATION TO 4
   EQU DICT.CONVERSION TO 7
   EQU DICT.CORRELATIVE TO 8
   EQU DICT.JUSTIFICATION TO 9
   EQU DICT.WIDTH TO 10
*
   DIM ATTRIBUTE.ITEM(10)
   DIM NAME.ITEM(10)
*
   MAT ATTRIBUTE.ITEM = ''
   MAT NAME.ITEM = ''
*
   CALL GET.ARGUMENTS(ARGS)
*
   ARGS.LEN = DCOUNT(ARGS,@AM)
*
   IF ARGS.LEN = 1 THEN
      PRINT 'ADD-DICT - Add a DICT entry to a file'
      PRINT
      PRINT 'FLAGS: ' 
      PRINT '   -F,  --FILE.NAME '
      PRINT '   -A,  --ATTRIBUTE.NUMBER'
      PRINT '   -N,  --ATTRIBUTE.NAME'
      PRINT '   -CV, --CONVERSION'
      PRINT '   -CR, --CORRELATIVE'
      PRINT '   -J,  --JUSTIFICATION'
      PRINT '   -W,  --WIDTH'
      PRINT
      PRINT 'EXAMPLES: ' 
      PRINT '   ADD-DICT -F {FILE-NAME} -A {ATTR.#} -N {DICT.NAME}'
      PRINT '   ADD-DICT -F {FILE-NAME} -A {ATTR.#} -N {DICT.NAME} -J R -CV MD2'
      PRINT
      STOP
   END
*
   FORCE.FLAG = FALSE
*
   FILE.NAME = ''
   ATTRIBUTE.NUMBER = ''
   ATTRIBUTE.NAME = ''
   MV.RELATION = ''
   CONVERSION = ''
   CORRELATIVE = ''
   JUSTIFICATION = 'L'
   WIDTH = '25'
*
   LOCATE('-F',ARGS;FLAG.POS) THEN
      FILE.NAME = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END
*
   LOCATE('--FILE.NAME',ARGS;FLAG.POS) THEN
      FILE.NAME = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END ELSE
      IF FILE.NAME = '' THEN
         PRINT 'Filename is missing.'
         STOP
      END
   END
*
   LOCATE('-A',ARGS;FLAG.POS) THEN
      ATTRIBUTE.NUMBER = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END
*
   LOCATE('--ATTRIBUTE.NUMBER',ARGS;FLAG.POS) THEN
      ATTRIBUTE.NUMBER = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END ELSE
      IF ATTRIBUTE.NUMBER = '' THEN
         PRINT 'Attribute number is missing.'
         STOP
      END
   END
*
   LOCATE('-N',ARGS;FLAG.POS) THEN
      ATTRIBUTE.NAME = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END
*
   LOCATE('--ATTRIBUTE.NAME',ARGS;FLAG.POS) THEN
      ATTRIBUTE.NAME = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END ELSE
      IF ATTRIBUTE.NAME = '' THEN
         PRINT 'Attribute name is missing.'
         STOP
      END
   END
*
   LOCATE('-CV',ARGS;FLAG.POS) THEN
      CONVERSION = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END
*
   LOCATE('--CONVERSION',ARGS;FLAG.POS) THEN
      CONVERSION = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END
*
   LOCATE('-CR',ARGS;FLAG.POS) THEN
      CORRELATIVE = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END
*
   LOCATE('--CORRELATIVE',ARGS;FLAG.POS) THEN
      CORRELATIVE = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END
*
   LOCATE('-J',ARGS;FLAG.POS) THEN
      JUSTIFICATION = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END
*
   LOCATE('--JUSTIFICATION',ARGS;FLAG.POS) THEN
      JUSTIFICATION = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END
*
   LOCATE('-W',ARGS;FLAG.POS) THEN
      ATTRIBUTE.NAME = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END
*
   LOCATE('--WIDTH',ARGS;FLAG.POS) THEN
      WIDTH = ARGS<FLAG.POS+1>
      ARGS = DELETE(ARGS,FLAG.POS)
      ARGS = DELETE(ARGS,FLAG.POS)
   END
*
   LOCATE('--FORCE',ARGS;FLAG.POS) THEN
      FORCE.FLAG = TRUE
      ARGS = DELETE(ARGS,FLAG.POS)
   END
*
   OPEN '',FILE.NAME TO FILE ELSE
      PRINT 'File does not exist: ' : FILE.NAME
      STOP
   END
*
   OPEN 'DICT',FILE.NAME TO DICT.FILE ELSE
      PRINT 'DICT does not exist: ' : FILE.NAME
      STOP
   END
*
   MATREAD NAME.ITEM FROM DICT.FILE,ATTRIBUTE.NAME THEN
      IF FORCE.FLAG = FALSE THEN
         PRINT 'DICT entry already exists: ' : ATTRIBUTE.NAME
         PRINT 'No changes made'
         STOP
      END
   END
*
   NAME.ITEM(DICT.TYPE) = 'A'
   NAME.ITEM(DICT.FIELD) = ATTRIBUTE.NUMBER
   NAME.ITEM(DICT.DESCRIPTION) = ATTRIBUTE.NAME
   NAME.ITEM(DICT.MV.RELATION) = MV.RELATION
   NAME.ITEM(5) = ''
   NAME.ITEM(6) = ''
   NAME.ITEM(DICT.CONVERSION) = CONVERSION
   NAME.ITEM(DICT.CORRELATIVE) = CORRELATIVE
   NAME.ITEM(DICT.JUSTIFICATION) = JUSTIFICATION
   NAME.ITEM(DICT.WIDTH) = WIDTH 
*
   ATTRIBUTE.ITEM(DICT.TYPE) = 'S'
   ATTRIBUTE.ITEM(DICT.FIELD) = ATTRIBUTE.NUMBER
   ATTRIBUTE.ITEM(DICT.DESCRIPTION) = ATTRIBUTE.NAME
   ATTRIBUTE.ITEM(DICT.MV.RELATION) = MV.RELATION
   ATTRIBUTE.ITEM(5) = ''
   ATTRIBUTE.ITEM(6) = ''
   ATTRIBUTE.ITEM(DICT.CONVERSION) = CONVERSION   
   ATTRIBUTE.ITEM(DICT.CORRELATIVE) = CORRELATIVE
   ATTRIBUTE.ITEM(DICT.JUSTIFICATION) = JUSTIFICATION
   ATTRIBUTE.ITEM(DICT.WIDTH) = WIDTH 
*
   MATWRITE NAME.ITEM ON DICT.FILE,ATTRIBUTE.NAME
*
   ATTRIBUTE.ON.FILE = FALSE
*
   MATWRITE ATTRIBUTE.ITEM ON DICT.FILE,ATTRIBUTE.NUMBER
*
   READ AT.ITEM FROM DICT.FILE,'@' THEN
      ATTRIBUTES = AT.ITEM<2>
*
      CONVERT ' ' TO @AM IN ATTRIBUTES
*
      LOCATE(ATTRIBUTE.NUMBER,ATTRIBUTES;ATTR.POS) ELSE
         AT.ITEM<2> = AT.ITEM<2> : ' ' : ATTRIBUTE.NUMBER
         WRITE AT.ITEM ON DICT.FILE,'@'
      END
*
   END ELSE
      AT.ITEM = ''
      AT.ITEM<1> = 'PH'
      AT.ITEM<2> = ATTRIBUTE.NUMBER
      WRITE AT.ITEM ON DICT.FILE,'@'
   END
*
* END OF PROGRAM
*
   END
*
